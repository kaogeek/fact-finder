# Fact Finder - gdrive-bot

<table cellspacing="0" cellpadding="0" border="0" cellborder="0" style="border: 0;">
<tr>
<td style="border: 0;" style="text-align: center;">
  <a href="https://twitter.com/factfinderbot" target="_blank">
    <img src="https://pbs.twimg.com/profile_images/1426894389704491009/Jwd8htLk_400x400.jpg" alt="Fact Finder Bot" style="border-radius: 50%; width: 120px;" width="120">
  </a>
  <div style="font-size: 14px; margin-top: 10px; text-align: center;">
    <a href="https://twitter.com/factfinderbot" target="_blank">@factfinderbot</a>
  </div>
</td>
<td style="border: 0;">
  <blockquote style="font-size: 20px;">
    " <strong> I crave EXIFs ü§ñü§ñü§ñ.</strong><br/>
      Feed me the files with EXIF!"
  </blockquote>
</td>
</tr>
</table>

Live (Release): https://factfinder.app \
Preview (Dev): https://fact-finder.vercel.app

## ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö <a name="compare"></a>


| ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏î‡∏ß‡∏Å | ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠ | ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß |
| :---:  | :---:     | :---:        | :---:      | :---: |
| **[Twitter](../twitter-bot)** | **‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤** | ‡πÑ‡∏°‡πà‡∏°‡∏µ | ‡∏ô‡πâ‡∏≠‡∏¢ | ‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
| **[Google Drive](./)** | ‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ | *‡∏°‡∏µ‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô* | **‡∏°‡∏≤‡∏Å (EXIF)** | **‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î**
| **[LINE](../line-bot)** | **‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤** | **‡∏°‡∏µ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå** | ‡∏ô‡πâ‡∏≠‡∏¢ | *‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤*

*- **‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏î‡∏ß‡∏Å (accessibility):** ‡∏ß‡∏±‡∏î‡∏ú‡∏•‡∏à‡∏≤‡∏Å ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏û‡∏£‡πà‡∏´‡∏•‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡∏Ç‡∏≠‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ô‡∏±‡πâ‡∏ô ‡πÜ* \
*- **‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (structural data input):** ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ô‡∏±‡πâ‡∏ô ‡πÜ ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ñ‡∏≤‡∏°-‡∏ï‡∏≠‡∏ö ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?* \
*- **‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠ (data trustworthiness):** ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ ‡∏Ñ‡∏∑‡∏≠‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏î‡∏¢‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÇ‡∏î‡∏¢‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏á‡πà‡∏≤‡∏¢‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î* \
*- **‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß (privacy):** ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?*

## ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• ‡∏ó‡∏≥‡πÉ‡∏´‡πâ **‡∏ú‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡∏ñ‡∏≠‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• [EXIF](https://en.wikipedia.org/wiki/Exif) ‡πÅ‡∏•‡∏∞ metadata ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå ‡∏†‡∏≤‡∏û ‡πÅ‡∏•‡∏∞ ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠**  ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô platform ‡∏ô‡∏±‡πâ‡∏ô ‡πÜ [See: [What happens to the Exif data for my photo?](https://help.twitter.com/en/using-twitter/tweeting-gifs-and-pictures)]

‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏ô‡∏µ‡πâ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ **Fact Finder ‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç *‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏î‡πâ*** ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤ (timestamp) ‡πÅ‡∏•‡∏∞ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà (geotag) ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ù‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô EXIF data ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û

## ‡∏ó‡∏≤‡∏á‡∏≠‡∏≠‡∏Å

‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (data source) ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á *Google Drive* (‡∏î‡∏π [‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö](#compare) ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô)

---

## Specification

A bot should crawl data from [Fact Finder Upload](https://drive.google.com/drive/u/5/folders/10Tqb4HkVjUO6ruyE8qhbrH6pP8JqbGFl) gdrive folder and move processed files to [Fact Finder](https://drive.google.com/drive/u/5/folders/1KSrbCxb023YG6x353as4qcLZ5WlHZja0) processed folder. Then, save crawled data into db to letting web `frontend` to display them.

The bot must extract EXIF data from file if available.

## How to run

### Prerequisites

Do the following steps once you newly clone/checkout the project from the repository.

#### Install firebase-tool

```
npm install -g firebase-tools
```
*See: https://github.com/firebase/firebase-tools*

#### Install firebase-config-sync

```
npm install -g firebase-config-sync
```
*See: https://www.npmjs.com/package/firebase-config-sync*

#### Install dependencies
Go to `gdrive-bot/functions` directory then run:
```
npm install
```

### Firebase config

#### Syncing config from GCP <a name="config-sync-get"></a>
Go to `gdrive-bot` directory then run:
```
firebase-config-sync get
```
After executing this command, the `.runtimeconfig.json` should be created in `gdrive-bot/functions` directory.

#### Edit config locally
You can edit local config file which is only used in the emulator at `gdrive-bot/functions/.runtimeconfig.json`.
```json
{
  "drive": {    
    "service_account": {
      "client_email": "",
      "private_key": ""
    },
    "upload_folder_id": "1WgbYlz03qJ2Js3nIvxkwTPWINGoKas2g",
    "processed_folder_id": "1v_9eD4Tzgzu4i1WuZi330QSWOERm5Omj",
    "max_files_size": "150",
    "time_zone": "+07:00"
  },
  "dev_drive": { 
    "service_account": {
      "client_email": "",
      "private_key": ""
    },
    "upload_folder_id": "10Tqb4HkVjUO6ruyE8qhbrH6pP8JqbGFl",
    "processed_folder_id": "1KSrbCxb023YG6x353as4qcLZ5WlHZja0",
    "max_files_size": "150",
    "time_zone": "+07:00"
  }
}

```

#### Syncing config to GCP <a name="config-sync-set"></a>
Go to `gdrive-bot` directory then run:
```
firebase-config-sync set
```
After executing this command, the `.runtimeconfig.json` will be propagated to GCP.

### Run on Local Server

##### Before you go
If you're running cloud functions for the first time, *you may need to do the following steps manually at least once.*

###### Create local firebase config
To run cloud functions on local emulators, the local firebase config `.runtimeconfig.json` must be provided in `gdrive-bot/functions` directory. If you're not sure how to set up the config manually, just [sync](#config-sync-get) the config from GCP to your local server.

###### Compile typescript sources
Go to `gdrive-bot/functions` directory then run:
```
npm run build
```

##### Run firebase emulator
Go to `gdrive-bot` directory then run:
```
firebase emulators:start
```
You can now access firebase emulators ui on local server on the port displayed from command output.

##### Call your functions via firebase shell
Open another cli (cmd, terminal, etc.) process and go to `gdrive-bot` directory, then run:
```
firebase functions:shell
```
You can now call cloud functions directly from the shell. For example:
```
firebase> helloWorld()
```

##### Call your functions via RESTful API

Your cloud functions will be up & running on:
`https://localhost:$PORT/fact-finder-app/$REGION/$FUNCTION_NAME`

*See: https://firebase.google.com/docs/functions/local-emulator*

### Deploy on GCP

**ATTENTION!** Everytime you make changes to local config, don't forget to [sync](config-sync-set) those changes to GCP before deploying your code.

To deploy your code to GCP:
```
firebase deploy --only functions
```
